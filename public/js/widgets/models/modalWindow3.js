uncrd.define(["jquery","knockout"],function(e,t){var n=function(n){var r=this,i=n.options;this.header=this.asObservable(i.header,""),this.headerWidget=this.asObservable(i.headerWidget,null),this.footerWidget=this.asObservable(i.footerWidget,null),this.content=this.asObservable(i.content,null),this.width=this.asObservable(i.width,560),this.cssPosition=this.asObservable(i.cssPosition,"fixed"),this.leftBackdropAction=this.asObservable(i.leftBackdropAction,null),this.xPosition=t.utils.unwrapObservable(i.xPosition)||"center",this.yPosition=t.utils.unwrapObservable(i.yPosition)||"center",this.xOffset=t.utils.unwrapObservable(i.xOffset)||0,this.yOffset=t.utils.unwrapObservable(i.yOffset)||0,i.widgetData&&i.widgetData.hasOwnProperty("name")&&(this.requiresLoading=!0,this.isReady=!1),this.pageWidgetBinding=t.computed(function(){return!i.widgetData||!i.widgetData.hasOwnProperty("name")?!1:e.extend({},n.options.widgetData,{modalWindow:r,callback:function(e){!e.requiresLoading||e.isReady?r.widgetReadyCallback(e):e.on("ready",function(){r.widgetReadyCallback(e)}),r.recalculatePositionTrue()}})}),this.buttons=t.observableArray([]),this.buttons.push({action:function(){r.destroy()},css:"",text:"Закрыть"}),this.widgetReadyCallback=function(t){r.isReady=!0,r.recalculatePositionTrue(),e.isFunction(i.widgetData.callback)&&i.widgetData.callback(t),r.emit("ready")},this.position=t.observable({});var s=null,o=null,u=null,a=null;this.width.subscribe(function(e){r.recalculatePositionTrue()}),this.recalculatePosition=function(t,n){if(!r.container)return;var i={},f={};if(t||!s||!o||!u||!a)s=e(window).width(),o=e(window).height(),u=r.container.outerWidth(!0),a=r.container.outerHeight(!0),r.xOffset=0,r.yOffset=0;r.xPosition=="left"?f.left=0:r.xPosition=="center"||r.xPosition=="middle"?f.left=Math.floor((s-u)/2):r.xPosition=="right"&&(f.right=0),r.yPosition=="top"?f.top=0:r.yPosition=="center"||r.yPosition=="middle"?f.top=Math.floor((o-a)/2):r.yPosition=="bottom"&&(f.bottom=0),f.hasOwnProperty("left")&&(i.left=f.left+r.xOffset,i.left+u>s&&(i.left=s-u),i.left<0&&(i.left=0),r.xOffset=i.left-f.left,i.left=i.left.toString()+"px"),f.hasOwnProperty("right")&&(i.right=f.right-r.xOffset,i.right+u>s&&(i.right=s-u),i.right<0&&(i.right=0),r.xOffset=f.right-i.right,i.right=i.right.toString()+"px"),f.hasOwnProperty("top")&&(i.top=f.top+r.yOffset,i.top+a>o&&(i.top=o-a),i.top<0&&(i.top=0),r.yOffset=i.top-f.top,i.top=i.top.toString()+"px"),f.hasOwnProperty("bottom")&&(i.bottom=f.bottom-r.yOffset,i.bottom+a>o&&(i.bottom=o-a),i.bottom<0&&(i.bottom=0),r.yOffset=f.bottom-i.bottom,i.bottom=i.bottom.toString()+"px"),r.width()&&(i.width=r.width()+"px"),r.cssPosition()&&(i.position=r.cssPosition()),r.position(i),t&&!n&&setTimeout(function(){r.recalculatePosition(!0,1)},100),t&&n==1&&setTimeout(function(){r.recalculatePosition(!0,2)},500)},this.recalculatePositionTrue=function(e){return r.recalculatePosition(!0)},this.dragStart=function(t,n){t.emit("dragStart");var r=n.pageX,i=n.pageY,s=t.xOffset,o=t.yOffset,u=function(e){t.xOffset=s+e.pageX-r,t.yOffset=o+e.pageY-i,t.recalculatePosition()};e(document).on("mousemove",u).one("mouseup mouseleave",function(n){e(document).off("mousemove",u),t.emit("dragEnd")})},this.domInit=function(t,n,i){r.container=e(i),e(window).on("resize",r.recalculatePositionTrue),r.recalculatePositionTrue()},this.domDestroy=function(){e(window).off("resize",r.recalculatePositionTrue),r.emit("destroy")},this.preventDrag=function(e,t){t.preventDefault(),t.stopPropagation()}};return n});